(()=>{"use strict";var e=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)&&!function(e){return e.some((function(e){return!e.value}))}(e)?(t.classList.remove("button_type_save-inactive"),t.disabled=!1):(t.classList.add("button_type_save-inactive"),t.disabled=!0)},t=function(){Array.from(document.querySelectorAll(".form")).forEach((function(t){!function(t){var n=Array.from(t.querySelectorAll(".form__input")),o=t.querySelector(".button_type_save");e(n,o),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t){t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("".concat(t.classList[0],"_type_error")),n.classList.remove("".concat(t.classList[0],"-error_active")),n.textContent=""}(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("".concat(t.classList[0],"_type_error")),o.textContent=n,o.classList.add("".concat(t.classList[0],"-error_active"))}(e,t,t.validationMessage)}(t,r),e(n,o)}))}))}(t)}))};t();var n=document.querySelector("#photo-grid").content,o=document.querySelector(".elements"),r=document.querySelector(".popup_big-view"),c=document.querySelector(".element__illustration_big-view"),a=document.querySelector(".element__text_big-view"),u=document.querySelector(".button_type_edit"),i=document.querySelector(".popup_type_profile"),s=document.querySelector(".button_type_add"),l=document.querySelector(".popup_type_photo"),d=Array.from(document.querySelectorAll(".popup")),f=document.querySelector(".form_type_profile"),_=document.querySelector(".form__input_type_name"),p=document.querySelector(".form__input_type_job"),m=(document.querySelector(".profile__user-name"),document.querySelector(".profile__user-info"),document.querySelector(".profile__user-name")),y=document.querySelector(".profile__user-info"),h=document.querySelector(".avatar"),v=document.querySelector(".popup_type_avatar"),b=document.querySelector(".avatar-box"),S=document.querySelector(".form_type_avatar"),q=document.querySelector(".avatar"),L=Array.from(document.querySelectorAll(".button_type_close")),k=function(e){"Escape"===e.key&&E(popup)};function g(e){e.classList.add("popup_opened"),document.addEventListener("keydown",k)}function E(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",k)}L.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return E(t)}))}));var w=document.querySelector(".wrapper__header");window.addEventListener("resize",(function(){window.innerWidth<=320&&w.classList.contains("wrapper")?w.classList.remove("wrapper"):window.innerWidth>320&&!w.classList.contains("wrapper")&&w.classList.add("wrapper")})),d.forEach((function(e){e.addEventListener("click",(function(t){t.target===e&&E(e)}))})),u.addEventListener("click",(function(){g(i)})),s.addEventListener("click",(function(){g(l)})),b.addEventListener("click",(function(){g(v)}));var j=document.querySelector(".form__input_type_avatar");function x(e){document.querySelectorAll(".button_type_save").forEach((function(t){t.textContent=e?"Сохранение...":"Сохранить"}))}S.addEventListener("submit",(function(e){e.preventDefault(),x(!0),z().finally((function(){return x(!1)})),E(v),e.target.reset()})),f.addEventListener("submit",(function(e){e.preventDefault(),console.log(1),x(!0),console.log(2),T().finally((function(){return x(!1)})),console.log(3),E(i),e.target.reset()}));var C=document.querySelector(".form__input_type_place-name"),A=document.querySelector(".form__input_type_photo-url");function P(e,t,o,u,i,s){var l=n.querySelector(".element").cloneNode(!0),d=l.querySelector(".element__illustration"),f=l.querySelector(".element__text"),_=l.querySelector(".likes-amount"),p=l.querySelector(".element__trash"),m=l.querySelector(".button_type_like");"ec533366206c7cdb342d7b32"!==i&&(p.style.display="none"),d.src=t,_.textContent=o,d.alt="иллюстрация",f.textContent=e;var y=u.find((function(e){return"ec533366206c7cdb342d7b32"===e._id}));return y&&m.classList.add("button_type_like-active"),l.addEventListener("click",(function(e){e.target.classList.contains("button_type_like")&&!e.target.classList.contains("button_type_like-active")?(O(s).then((function(e){return _.textContent=e.likes.length})),e.target.classList.add("button_type_like-active")):e.target.classList.contains("button_type_like")&&e.target.classList.contains("button_type_like-active")?(J(s).then((function(e){return _.textContent=e.likes.length})),e.target.classList.remove("button_type_like-active")):e.target.classList.contains("element__trash")?(N(s),e.target.closest(".element").remove()):e.target.classList.contains("element__illustration")&&(c.src=d.src,c.alt="иллюстрация",a.textContent=f.textContent,g(r))})),l}document.querySelector(".form_type_photo").addEventListener("submit",(function(e){e.preventDefault(),x(!0),D().then((function(e){var t=P(e.name,e.link,e.likes.length,e.likes,e.owner._id,e._id);o.prepend(t)})).finally((function(){return x(!1)})),E(l),e.target.reset()}));var U={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-5",headers:{authorization:"841c5014-6808-4c4d-aebc-fbc939821d00","Content-Type":"application/json"}},T=function(){return fetch("".concat(U.baseUrl,"/users/me"),{method:"PATCH",headers:U.headers,body:JSON.stringify({name:"".concat(_.value),about:"".concat(p.value)})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){m.textContent=e.name,y.textContent=e.about})).catch((function(e){console.log(e)}))},D=function(){return fetch("".concat(U.baseUrl,"/cards"),{method:"POST",headers:U.headers,body:JSON.stringify({name:"".concat(C.value),link:"".concat(A.value)})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))},N=function(e){return fetch("".concat(U.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:U.headers})},O=function(e){return fetch("".concat(U.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:U.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))},J=function(e){return fetch("".concat(U.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:U.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))},z=function(){return fetch("".concat(U.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:U.headers,body:JSON.stringify({avatar:"".concat(j.value)})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return q.src=e.avatar})).catch((function(e){console.log(e)}))};fetch("".concat(U.baseUrl,"/cards"),{headers:U.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e.map((function(e){return P(e.name,e.link,e.likes.length,e.likes,e.owner._id,e._id)}))})).then((function(e){e.forEach((function(e){o.append(e)}))})).catch((function(e){console.log(e)})),fetch("".concat(U.baseUrl,"/users/me"),{headers:U.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){m.textContent=e.name,y.textContent=e.about,h.src=e.avatar})).catch((function(e){console.log(e)})),t()})();